<!doctype html><html lang=en><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><title>System</title><link href=styles.css rel=stylesheet></head><body><div class=container><div class=sidebar><div class=menu-section><h3 class="menu-header active">Overview</h3><ul><li><a href=/>Overview</a></li><li><a class=active href=/slaves.html>Slaves</a></li></ul></div><div class=menu-section><h3 class=menu-header>System</h3><ul><li><a href=/systems.html>System</a></li><li><a href=/modbus.html>Modbus</a></li><li><a href=/mqtt.html>MQTT</a></li><li><a class=active href=/mapping.html>Mapping</a></li></ul></div><div class=menu-section><h3 class=menu-header>Network</h3><ul><li><a href=/wifi.html>WiFi</a></li><li><a href=/wan.html>WAN</a></li><li><a href=/lan.html>LAN</a></li></ul></div><div class=menu-section><h3 class=menu-header>Other</h3><ul><li><a href=/other.html>Other</a></li></ul></div></div><div class=main-content><div class="content-section active"><h2>Mapping</h2><div class=modbus-poll-settings-content><div class=modbus-gateway-section><h3 class=section-header>Mapping</h3><div style="max-width: 800px; overflow-x: scroll;" class=modbus-node-nav id=mapping_node></div><div class="modbus-node-add-btn-group button-group"><button class=add-btn id=mapping-add-btn type=button>Add</button><button class=remove-btn id=mapping-remove-btn type=button>Remove</button></div><table class=modbus-node-table><thead><tr><th>Funtion</th><th>Offset address</th><th>Key</th><th>Type</th><th></th></tr></thead><tbody id=detail_mapping></tbody></table><form class=modbus-node-form id=modbus-node-form><div class=modbus-node-form-table><div class=modbus-node-form-row><label>Function</label><select id=mapping_func iotinput=int><option value=1>1</option><option value=2>2</option><option value=3>3</option><option value=4>4</option></select></div><div class=modbus-node-form-row><label>Offset address</label><input id=mapping_offset min=0 type=number value=0></div><div class=modbus-node-form-row><label>Key</label><input id=mapping_key type=text></div><div class=modbus-node-form-row><label>Type</label><select id=mapping_type iotinput=int></select></div></div><div style="justify-content: flex-end;" class=button-group><button class=add-btn id=cell-add-btn type=button>Add</button><button class=save-btn id=cell-save-btn type=button>Save</button><button class=reset-btn id=cell-reset-btn type=button>Reset</button></div></form><div style="justify-content: flex-end; margin-top: 20px;" class=button-group><button class=save-btn id=mapping-save-btn type=button>Save</button><button class=reset-btn id=mapping-reset-btn type=button>Reset</button></div></div><div class=modbus-node-section><h3 class=section-header>Slaves</h3><table class=modbus-gateway-table><thead><tr><th>ID</th><th>Name</th><th>Mapping</th><th></th></tr></thead><tbody id=list-slave></tbody></table><form class=modbus-node-form id=modbus-node-form><div class=modbus-node-form-table><div class=modbus-node-form-row><label>ID</label><input id=slave_id max=255 min=0 type=number value=0></div><div class=modbus-node-form-row><label>Name</label><input id=slave_name type=text></div><div class=modbus-node-form-row><label>Mapping</label><select id=slave_mapping iotinput=int></select></div></div><div style="justify-content: flex-end;" class=button-group><button class=add-btn id=cell-slave-add-btn type=button>Add</button><button class=save-btn id=cell-slave-save-btn type=button>Save</button><button class=reset-btn id=cell-slave-reset-btn type=button>Reset</button></div></form><div style="justify-content: flex-end; margin-top: 20px;" class=button-group><button class=save-btn id=slave-save-btn type=button>Save</button><button class=reset-btn id=slave-reset-btn type=button>Reset</button></div></div></div></div></div></div></body><script>const HOST_IP=window.location.host,MAP_TYPE_DATA={bool:0,int8:1,uint8:2,int16:3,uint16:4,int32:5,uint32:6,int32_reverse:7,uint32_reverse:8,float32:9,float32_reverse:10,int64:11,uint64:12,int64_reverse:13,uint64_reverse:14,float64:15,float64_reverse:16},MAP_TYPE_DATA_KEY=Object.keys(MAP_TYPE_DATA),mapping_node=document.getElementById("mapping_node"),detail_mapping=document.getElementById("detail_mapping"),node_btns=document.getElementsByClassName("node-btn"),mapping_add_btn=document.getElementById("mapping-add-btn"),mapping_remove_btn=document.getElementById("mapping-remove-btn"),mapping_reset_btn=document.getElementById("mapping-reset-btn"),mapping_save_btn=document.getElementById("mapping-save-btn"),mapping_func=document.getElementById("mapping_func"),mapping_offset=document.getElementById("mapping_offset"),mapping_key=document.getElementById("mapping_key"),mapping_type=document.getElementById("mapping_type"),cell_add_btn=document.getElementById("cell-add-btn"),cell_save_btn=document.getElementById("cell-save-btn"),cell_reset_btn=document.getElementById("cell-reset-btn"),slave_list=document.getElementById("list-slave"),slave_id=document.getElementById("slave_id"),slave_name=document.getElementById("slave_name"),slave_mapping=document.getElementById("slave_mapping"),cell_slave_add_btn=document.getElementById("cell-slave-add-btn"),cell_slave_save_btn=document.getElementById("cell-slave-save-btn"),cell_slave_reset_btn=document.getElementById("cell-slave-reset-btn"),slave_save_btn=document.getElementById("slave-save-btn"),slave_reset_btn=document.getElementById("slave-reset-btn");var mapping_data=[],slave_data=[],cell_index=0,slave_index=null;const pad=(e,t)=>{for(e=e.toString();e.length<t;)e="0"+e;return e},getKeyByValue=(e,t)=>Object.keys(e).find((n=>e[n]===t)),loading=()=>{let e=MAP_TYPE_DATA_KEY.map((e=>`<option value="${MAP_TYPE_DATA[e]}">${e}</option>`));mapping_type.innerHTML=e},load_mapping=()=>{fetch(`http://${HOST_IP}/api/mapping`,{method:"GET"}).then((e=>e.json())).then((e=>{render_mapping_index(e),mapping_data=e,render_mapping(),reset_cell()}))},render_mapping=()=>{let e=mapping_data.map(((e,t)=>`<button class="node-btn" onclick="get_detail_profile(this)" index="${t}">0x${pad(t,2)}</button>`)).join("");mapping_node.innerHTML=e,detail_mapping.innerHTML=null},render_detail_mapping=e=>{let t=mapping_data[e].map(((e,t)=>`<tr onclick="fillKeyCell(this)" func="${e.func}" offset="${e.offset}" key="${e.key}" type="${e.type}" index="${t}"><td>0x${pad(Number(e.func),2)}</td><td>0x${pad(Number(e.offset),5)}</td><td>${e.key}</td><td>${getKeyByValue(MAP_TYPE_DATA,Number(e.type))}</td><td><button class="remove-btn" onclick="remove_cell(this)" index="${t}">Delete</button></td></tr>`)).join("");detail_mapping.innerHTML=t,reset_cell()},get_detail_profile=e=>{let t=e.getAttribute("index");for(const e of node_btns)e.classList.remove("active");e.classList.add("active"),render_detail_mapping(t)},fillKeyCell=e=>{cell_index=e.getAttribute("index"),mapping_func.value=e.getAttribute("func"),mapping_offset.value=e.getAttribute("offset"),mapping_key.value=e.getAttribute("key"),mapping_type.value=e.getAttribute("type")},reset_cell=()=>{cell_index=null,mapping_func.value=1,mapping_offset.value=0,mapping_key.value="",mapping_type.value=0},remove_cell=e=>{let t=e.getAttribute("index");for(const e of node_btns)if(e.classList.contains("active")){let n=e.getAttribute("index");mapping_data[n].splice(t,1),render_detail_mapping(n)}};mapping_reset_btn.onclick=()=>load_mapping(),mapping_remove_btn.onclick=()=>{for(const e of node_btns)if(e.classList.contains("active")){let t=e.getAttribute("index");mapping_data.splice(t,1),render_detail_mapping(t)}},mapping_add_btn.onclick=()=>{mapping_data.push([]),render_mapping()},mapping_save_btn.onclick=()=>{fetch(`http://${HOST_IP}/api/mapping`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(mapping_data)}).then((e=>e.json())).then((e=>{alert(e.message)})),loading(),load_mapping()},cell_add_btn.onclick=()=>{for(const e of node_btns)if(e.classList.contains("active")){let t=e.getAttribute("index");mapping_key.value?(mapping_data[t].push({func:mapping_func.value,offset:mapping_offset.value,key:mapping_key.value,type:mapping_type.value}),reset_cell(),render_detail_mapping(t)):alert("Key is Null")}},cell_save_btn.onclick=()=>{for(const e of node_btns)if(e.classList.contains("active")){let t=e.getAttribute("index");mapping_key.value?mapping_data[t][cell_index]={func:mapping_func.value,offset:mapping_offset.value,key:mapping_key.value,type:mapping_type.value}:alert("Key is Null"),render_detail_mapping(t)}},cell_reset_btn.onclick=()=>reset_cell();const render_mapping_index=e=>{let t=e.map(((e,t)=>`<option value="${t}">0x${pad(t,2)}</option>`));slave_mapping.innerHTML=t},remove_slave=e=>{let t=e.getAttribute("index");slave_data.splice(t,1),render_slaves()},fill_slave=e=>{slave_index=e.getAttribute("index"),slave_id.value=e.getAttribute("slave-id"),slave_name.value=e.getAttribute("slave-name"),slave_mapping.value=e.getAttribute("slave-mapping")},reset_slave=()=>{slave_index=null,slave_id.value=0,slave_name.value="",slave_mapping.value=0},render_slaves=()=>{let e=slave_data.map(((e,t)=>`<tr onclick="fill_slave(this)" slave-id="${e.id}" slave-name="${e.name}" slave-mapping="${e.profile}" index="${t}"><td>0x${pad(Number(e.id),4)}</td><td>${e.name}</td><td>0x${pad(e.profile,2)}</td><td><button class="remove-btn" onclick="remove_slave(this)" index="${t}">Delete</button></td></tr>`)).join("");slave_list.innerHTML=e},load_slaves=()=>{fetch(`http://${HOST_IP}/api/devices`,{method:"GET"}).then((e=>e.json())).then((e=>{slave_data=e,render_slaves(),reset_slave()}))};slave_reset_btn.onclick=()=>load_slaves(),cell_slave_save_btn.onclick=()=>{fetch(`http://${HOST_IP}/api/devices`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(slave_data)}).then((e=>e.json())).then((e=>{slave_data=e,load_slaves()}))},cell_slave_add_btn.onclick=()=>{slave_name.value?(slave_data.push({id:slave_id.value,name:slave_name.value,profile:slave_mapping.value}),render_slaves(),reset_slave()):alert("Name is Null")},cell_slave_reset_btn.onclick=()=>reset_slave(),load_slaves(),load_mapping(),loading();</script></html>
